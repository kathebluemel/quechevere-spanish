<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu√© Ch√©vere - Taller de Escritura</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fffaf0; }
        
        @media print {
            body { background-color: white; }
            .no-print { display: none !important; }
            #printable-area { 
                visibility: visible !important; 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%;
            }
            .print-container { border: none !important; shadow: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const SPECIAL_CHARS = [
            { char: '√°' }, { char: '√©' }, { char: '√≠' }, { char: '√≥' }, { char: '√∫' }, 
            { char: '√º' }, { char: '√±' }, { char: '√Å' }, { char: '√â' }, { char: '√ç' }, 
            { char: '√ì' }, { char: '√ö' }, { char: '√ë' }, { char: '¬ø' }, { char: '¬°' }
        ];

        const LEVELS = {
            noviceLow: {
                id: 'noviceLow', label: 'Novice Low', emoji: 'üå±', target: '3‚Äì10 words',
                color: 'bg-green-600', lightColor: 'bg-green-50', textColor: 'text-green-700',
                tagline: 'Words & memorized phrases',
            },
            noviceMid: {
                id: 'noviceMid', label: 'Novice Mid', emoji: 'üåø', target: '15‚Äì40 words',
                color: 'bg-teal-600', lightColor: 'bg-teal-50', textColor: 'text-teal-700',
                tagline: 'Simple phrases & sentences',
            },
        };

        const PROMPTS = [
            { id: 1, level: 'noviceLow', emoji: 'üëã', title: '¬°Hola! ‚Äî Introduction', writingTask: 'Write your name, where you are from, and your age.', scaffolding: 'Me llamo..., Soy de..., Tengo... a√±os.', culturalNote: 'Greetings are warm and personal in Spanish-speaking cultures!' },
            { id: 2, level: 'noviceLow', emoji: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', title: 'Mi Familia', writingTask: 'List 3-5 family members and their names.', scaffolding: 'Mi madre se llama..., Mi hermano es...', culturalNote: 'Family (extended family included) is the heart of life.' },
            { id: 3, level: 'noviceMid', emoji: 'üçΩÔ∏è', title: 'La Comida', writingTask: 'What do you like to eat? What do you dislike?', scaffolding: 'Me gusta comer..., No me gusta..., Porque es...', culturalNote: 'Lunch is often the biggest meal of the day in Spain.' },
            { id: 4, level: 'noviceMid', emoji: '‚öΩ', title: 'Mis Pasatiempos', writingTask: 'What do you do for fun? Who do you play with?', scaffolding: 'Juego al..., Practico..., Con mis amigos...', culturalNote: 'F√∫tbol is more than a sport; it is a passion!' }
        ];

        function App() {
            const [level, setLevel] = useState('noviceLow');
            const [view, setView] = useState('prompts');
            const [prompt, setPrompt] = useState(null);
            const [text, setText] = useState('');
            const [loading, setLoading] = useState(false);
            const [feedback, setFeedback] = useState(null);
            const [seconds, setSeconds] = useState(0);
            const [isActive, setIsActive] = useState(false);
            const textareaRef = useRef(null);

            // Timer Logic
            useEffect(() => {
                let interval = null;
                if (isActive) {
                    interval = setInterval(() => setSeconds(s => s + 1), 1000);
                } else {
                    clearInterval(interval);
                }
                return () => clearInterval(interval);
            }, [isActive]);

            const formatTime = (s) => {
                const mins = Math.floor(s / 60);
                const secs = s % 60;
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            };

            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;

            const startWriting = (p) => {
                setPrompt(p);
                setView('write');
                setText('');
                setSeconds(0);
                setIsActive(true);
            };

            const insertChar = (c) => {
                const ta = textareaRef.current;
                const start = ta.selectionStart;
                const end = ta.selectionEnd;
                const newText = text.slice(0, start) + c + text.slice(end);
                setText(newText);
                setTimeout(() => {
                    ta.selectionStart = ta.selectionEnd = start + 1;
                    ta.focus();
                }, 0);
            };

            const handleFeedback = () => {
                setLoading(true);
                setIsActive(false);
                // Simulated AI Feedback
                setTimeout(() => {
                    setFeedback({
                        strengths: ["Great vocabulary use!", "Excellent sentence structure for this level."],
                        correction: text.replace("soy de", "Soy de"),
                        advice: "Remember to capitalize the start of your sentences!",
                        encouragement: "¬°Fant√°stico! You are making great progress."
                    });
                    setLoading(false);
                    setView('feedback');
                }, 1500);
            };

            return (
                <div className="min-h-screen pb-12">
                    <nav className="bg-orange-600 text-white p-4 shadow-md no-print">
                        <div className="max-w-4xl mx-auto flex justify-between items-center">
                            <h1 className="text-xl font-bold">Qu√© Ch√©vere: Taller de Escritura</h1>
                            {view !== 'prompts' && (
                                <button onClick={() => setView('prompts')} className="text-sm bg-orange-700 px-3 py-1 rounded">Volver</button>
                            )}
                        </div>
                    </nav>

                    <main className="max-w-4xl mx-auto mt-8 px-4">
                        {view === 'prompts' && (
                            <div>
                                <div className="flex gap-4 mb-8">
                                    {Object.values(LEVELS).map(l => (
                                        <button key={l.id} onClick={() => setLevel(l.id)} 
                                            className={`flex-1 p-4 rounded-xl border-2 transition ${level === l.id ? `${l.color} text-white border-transparent shadow-lg` : 'bg-white text-gray-400 border-gray-100 hover:border-orange-200'}`}>
                                            <div className="text-2xl">{l.emoji}</div>
                                            <div className="font-bold">{l.label}</div>
                                            <div className="text-xs opacity-80">{l.tagline}</div>
                                        </button>
                                    ))}
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {PROMPTS.filter(p => p.level === level).map(p => (
                                        <button key={p.id} onClick={() => startWriting(p)} className="bg-white p-6 rounded-xl border border-gray-100 shadow-sm hover:shadow-md text-left transition group">
                                            <div className="text-3xl mb-2">{p.emoji}</div>
                                            <h3 className="font-bold text-gray-800 group-hover:text-orange-600">{p.title}</h3>
                                            <p className="text-sm text-gray-500 mt-1">{p.writingTask}</p>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'write' && (
                            <div className="space-y-4 no-print">
                                <div className="bg-white p-4 rounded-xl border shadow-sm">
                                    <h2 className="font-bold text-orange-600">Prompt: {prompt.title}</h2>
                                    <p className="text-gray-700 italic mt-1 text-sm">{prompt.writingTask}</p>
                                    <p className="text-xs text-blue-600 mt-2"><strong>Helpful:</strong> {prompt.scaffolding}</p>
                                </div>

                                <div className="flex justify-between items-end">
                                    <div className="flex gap-1">
                                        {SPECIAL_CHARS.map(c => (
                                            <button key={c.char} onClick={() => insertChar(c.char)} className="w-8 h-8 bg-white border border-gray-200 rounded font-bold hover:bg-orange-100">{c.char}</button>
                                        ))}
                                    </div>
                                    <div className="text-right text-xs font-mono text-gray-500">
                                        ‚è±Ô∏è {formatTime(seconds)} | üìù {wordCount} palabras
                                    </div>
                                </div>

                                <textarea ref={textareaRef} value={text} onChange={(e) => setText(e.target.value)} 
                                    className="w-full h-64 p-6 rounded-2xl border-2 border-orange-100 focus:border-orange-500 outline-none text-lg leading-relaxed shadow-inner"
                                    placeholder="Escribe aqu√≠ en espa√±ol..."
                                />

                                <button onClick={handleFeedback} disabled={wordCount < 1 || loading}
                                    className="w-full py-4 bg-orange-600 text-white font-bold rounded-xl shadow-lg hover:bg-orange-700 disabled:bg-gray-300 transition">
                                    {loading ? "Analizando..." : "‚ú® Obtener Feedback"}
                                </button>
                            </div>
                        )}

                        {view === 'feedback' && feedback && (
                            <div id="printable-area" className="space-y-6">
                                <div className="bg-white p-8 rounded-2xl border-2 border-gray-100 shadow-xl print-container">
                                    <div className="flex justify-between items-start border-b pb-4 mb-6">
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800">Tu Reporte de Escritura</h2>
                                            <p className="text-gray-500">Tema: {prompt.title} | {LEVELS[level].label}</p>
                                        </div>
                                        <div className="text-right text-sm text-gray-400">Tiempo: {formatTime(seconds)}</div>
                                    </div>

                                    <div className="mb-8">
                                        <h3 className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Tu Texto Original:</h3>
                                        <p className="text-lg text-gray-800 bg-gray-50 p-4 rounded-lg italic font-serif">"{text}"</p>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="bg-green-50 p-4 rounded-xl border border-green-100">
                                            <h4 className="font-bold text-green-700 mb-2">üåü Fortalezas:</h4>
                                            <ul className="text-sm text-green-800 space-y-1">
                                                {feedback.strengths.map((s, i) => <li key={i}>‚úì {s}</li>)}
                                            </ul>
                                        </div>
                                        <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                            <h4 className="font-bold text-blue-700 mb-2">üí° Sugerencia:</h4>
                                            <p className="text-sm text-blue-800">{feedback.advice}</p>
                                        </div>
                                    </div>

                                    <div className="mt-6 p-4 bg-orange-50 rounded-xl border border-orange-100">
                                        <p className="text-sm text-orange-800"><strong>Nota Cultural:</strong> {prompt.culturalNote}</p>
                                    </div>

                                    <div className="mt-8 text-center border-t pt-6">
                                        <p className="text-xl font-bold text-orange-600 mb-4">{feedback.encouragement}</p>
                                        <div className="flex gap-3 no-print">
                                            <button onClick={() => window.print()} className="flex-1 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition">üíæ Guardar PDF</button>
                                            <button onClick={() => setView('prompts')} className="flex-1 py-3 bg-gray-100 text-gray-600 rounded-lg font-bold hover:bg-gray-200 transition">üîÑ Otro Tema</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
